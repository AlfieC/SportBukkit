From f0526152cab31aef0ced363a88f81a2b1e3a98ad Mon Sep 17 00:00:00 2001
From: Steve Anton <anxuiz.nx@gmail.com>
Date: Thu, 2 Aug 2012 22:33:55 -0700
Subject: [PATCH] Use the display name for NamedEntitySpawn to allow for
 colored overhead names.

---
 .../minecraft/server/Packet20NamedEntitySpawn.java |   12 ++++++++----
 1 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/src/main/java/net/minecraft/server/Packet20NamedEntitySpawn.java b/src/main/java/net/minecraft/server/Packet20NamedEntitySpawn.java
index 25d4ab8..ec02561 100644
--- a/src/main/java/net/minecraft/server/Packet20NamedEntitySpawn.java
+++ b/src/main/java/net/minecraft/server/Packet20NamedEntitySpawn.java
@@ -24,11 +24,15 @@ public class Packet20NamedEntitySpawn extends Packet {
     public Packet20NamedEntitySpawn(EntityHuman entityhuman) {
         this.a = entityhuman.id;
 
-        // CraftBukkit start - limit name length to 16 characters
-        if (entityhuman.name.length() > 16) {
-            this.b = entityhuman.name.substring(0, 16);
+        // CraftBukkit start - send the display name instead of actual name to permit colors
+        // 16 characters is the max (this leads to cut off names)
+        org.bukkit.entity.Player pl = (org.bukkit.entity.Player) entityhuman.getBukkitEntity();
+        String name = pl.getDisplayName();
+
+        if (name.length() > 16) {
+            this.b = name.substring(0, 16);
         } else {
-            this.b = entityhuman.name;
+            this.b = name;
         }
         // CraftBukkit end
 
-- 
1.7.8.msysgit.0

