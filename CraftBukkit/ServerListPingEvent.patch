From 6b7163bbc266c529da1aa8ac19ae17537d91632d Mon Sep 17 00:00:00 2001
From: Daniel <ZetaetaDaniel@gmail.com>
Date: Sat, 12 May 2012 16:07:34 +0100
Subject: [PATCH] Adds ability to set the number of online players sent in
 ServerListPingEvent

---
 .../net/minecraft/server/PendingConnection.java    |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/PendingConnection.java b/src/main/java/net/minecraft/server/PendingConnection.java
index 5ff6cdd..677615f 100644
--- a/src/main/java/net/minecraft/server/PendingConnection.java
+++ b/src/main/java/net/minecraft/server/PendingConnection.java
@@ -12,6 +12,7 @@ import java.util.Random;
 import javax.crypto.SecretKey;

 import org.bukkit.event.player.PlayerHandshakeEvent; // CraftBukkit
+import org.bukkit.ChatColor; // CraftBukkit

 public class PendingConnection extends Connection {

@@ -155,9 +156,10 @@ public class PendingConnection extends Connection {
             org.bukkit.event.server.ServerListPingEvent pingEvent = org.bukkit.craftbukkit.event.CraftEventFactory.callServerListPingEvent(this.server.server, getSocket().getInetAddress(), this.server.getMotd(), playerlist.getPlayerCount(), playerlist.getMaxPlayers());
             if (packet254getinfo.d()) {
                 // CraftBukkit
-                s = pingEvent.getMotd() + "\u00A7" + playerlist.getPlayerCount() + "\u00A7" + pingEvent.getMaxPlayers();
+                s = ChatColor.stripColor(pingEvent.getMotd() + "\u00A7" + pingEvent.getNumPlayers() + "\u00A7" + pingEvent.getMaxPlayers());
             } else {
-                List list = Arrays.asList(new Serializable[] { Integer.valueOf(1), Integer.valueOf(73), this.server.getVersion(), this.server.getMotd(), Integer.valueOf(playerlist.getPlayerCount()), Integer.valueOf(playerlist.getMaxPlayers())});
+                // CraftBukkit
+                List list = Arrays.asList(new Serializable[] { Integer.valueOf(1), Integer.valueOf(73), this.server.getVersion(), pingEvent.getMotd(), Integer.valueOf(pingEvent.getNumPlayers()), Integer.valueOf(pingEvent.getMaxPlayers())});

                 Object object;

--
1.7.9.6 (Apple Git-31.1)
