From e1e81f3efc30ab61ca589030dc33b05a0efc963b Mon Sep 17 00:00:00 2001
From: EdGruberman <ed@rjump.com>
Date: Thu, 2 Aug 2012 16:10:15 -0700
Subject: [PATCH] Fix NPE when trying to reset bed spawn location to default

---
 .../java/net/minecraft/server/EntityHuman.java     |    1 +
 .../org/bukkit/craftbukkit/entity/CraftPlayer.java |    5 +++++
 2 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityHuman.java b/src/main/java/net/minecraft/server/EntityHuman.java
index 9665716..fc243d9 100644
--- a/src/main/java/net/minecraft/server/EntityHuman.java
+++ b/src/main/java/net/minecraft/server/EntityHuman.java
@@ -1055,6 +1055,7 @@ public abstract class EntityHuman extends EntityLiving implements ICommandListen
             this.spawnWorld = this.world.worldData.getName(); // CraftBukkit
         } else {
             this.c = null;
+            this.spawnWorld = ""; // CraftBukkit
             this.d = false;
         }
     }
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index a1e9f85..1253251 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -606,6 +606,11 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
     }

     public void setBedSpawnLocation(Location location, boolean override) {
+        if (location == null) {
+            getHandle().setRespawnPosition(null, override);
+            getHandle().spawnWorld = "";
+            return;
+        }
         getHandle().setRespawnPosition(new ChunkCoordinates(location.getBlockX(), location.getBlockY(), location.getBlockZ()), override);
         getHandle().spawnWorld = location.getWorld().getName();
     }
--
1.7.4.4
